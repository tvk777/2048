var t={},e=(t={BOARD_SIZE:4,EMPTY_CELL:0,NEW_TILE_VALUES:{TWO:2,FOUR:4},PROBABILITY_TWO:.9,WIN_TILE:2048,GAME_STATUS:{IDLE:"idle",PLAYING:"playing",WIN:"win",LOSE:"lose"},KEY_CODES:{LEFT:"ArrowLeft",RIGHT:"ArrowRight",UP:"ArrowUp",DOWN:"ArrowDown"}}).KEY_CODES,s=t.GAME_STATUS,r=t.BOARD_SIZE,i=t.EMPTY_CELL,a=t.NEW_TILE_VALUES,o=t.PROBABILITY_TWO,l=t.WIN_TILE,d=t.GAME_STATUS;const h=new class{constructor(t){this.size=r,this.status=d.IDLE,this.score=0,this.board=t||this.createEmptyBoard()}moveLeft(){this.slideLeft()&&(this.addRandomNumber(),this.renderCells())}moveRight(){this.slideRight()&&(this.addRandomNumber(),this.renderCells())}moveUp(){this.slideUp()&&(this.addRandomNumber(),this.renderCells())}moveDown(){this.slideDown()&&(this.addRandomNumber(),this.renderCells())}getScore(){return this.score}getState(){return this.board}getStatus(){return this.status}start(){this.board=this.createEmptyBoard(),this.status="playing",this.score=0,this.updateScore(),this.addRandomNumber(),this.addRandomNumber(),this.renderCells(),this.updateMessage()}restart(){this.start()}createEmptyBoard(){return Array.from({length:this.size},()=>Array(this.size).fill(i))}getEmptyCells(){let t=[];for(let e=0;e<this.size;e++)for(let s=0;s<this.size;s++)this.board[e][s]===i&&t.push({row:e,cell:s});return t}addRandomNumber(){let t=this.getEmptyCells();if(0===t.length)return this.board;let e=Math.floor(Math.random()*t.length),s=Math.random()<o?a.TWO:a.FOUR,{row:r,cell:i}=t[e];return this.board[r][i]=s,this.board}renderCells(){let t=document.querySelector(".game-field");for(let e=0;e<this.size;e++)for(let s=0;s<this.size;s++){let r=this.board[e][s]>0?this.board[e][s]:"";t.rows[e].cells[s].classList.value="field-cell",t.rows[e].cells[s].textContent=r,r>0&&t.rows[e].cells[s].classList.add(`field-cell--${r}`)}}slide(t){let e=t.filter(t=>0!==t);for(let t=0;t<e.length-1;t++)e[t]===e[t+1]&&(e[t]*=2,e[t+1]=0,this.updateScore(e[t]));for(e=e.filter(t=>0!==t);e.length<this.size;)e.push(0);return e}slideLeft(){let t=this.board.map(t=>[...t]);for(let t=0;t<this.size;t++){let e=this.slide(this.board[t]);this.board[t]=e}return JSON.stringify(t)!==JSON.stringify(this.board)}slideRight(){let t=this.board.map(t=>[...t]);for(let t=0;t<this.size;t++){let e=this.slide(this.board[t].reverse());this.board[t]=e.reverse()}return JSON.stringify(t)!==JSON.stringify(this.board)}slideUp(){let t=this.board.map(t=>[...t]);for(let t=0;t<this.size;t++){let e=[];for(let s=0;s<this.size;s++)e.push(this.board[s][t]);let s=this.slide(e);for(let e=0;e<this.size;e++)this.board[e][t]=s[e]}return JSON.stringify(t)!==JSON.stringify(this.board)}slideDown(){let t=this.board.map(t=>[...t]);for(let t=0;t<this.size;t++){let e=[];for(let s=0;s<this.size;s++)e.push(this.board[s][t]);let s=this.slide(e.reverse()).reverse();for(let e=0;e<this.size;e++)this.board[e][t]=s[e]}return JSON.stringify(t)!==JSON.stringify(this.board)}updateScore(t=0){this.score+=t,document.querySelector(".game-score").textContent=this.score}updateMessage(){this.checkStatus();let t=document.querySelector(".message-start"),e=document.querySelector(".message-lose"),s=document.querySelector(".message-win");switch(this.status){case"idle":t.classList.remove("hidden");break;case"playing":t.classList.add("hidden"),s.classList.add("hidden"),e.classList.add("hidden");break;case"win":s.classList.remove("hidden");break;case"lose":e.classList.remove("hidden")}}canMerge(){let t=!1;for(let e=0;e<this.size-1;e++)for(let s=0;s<this.size-1;s++)(this.board[e][s]===this.board[e][s+1]||this.board[e][s]===this.board[e+1][s])&&(t=!0);return t}checkStatus(){return this.board.some(t=>t.includes(l))&&(this.status=d.WIN),0!==this.getEmptyCells().length||this.canMerge()||(this.status=d.LOSE),this.status}},n=document.querySelector(".start");n.addEventListener("click",t=>{n.classList.contains("start")&&h.start(),n.classList.contains("restart")&&h.restart(),n.classList.remove("start"),n.classList.add("restart"),n.textContent="Restart"}),document.addEventListener("keydown",t=>{if(h.getStatus()===s.PLAYING){switch(t.key){case e.LEFT:h.moveLeft();break;case e.RIGHT:h.moveRight();break;case e.UP:h.moveUp();break;case e.DOWN:h.moveDown()}h.updateMessage()}});
//# sourceMappingURL=index.5aeff38e.js.map
